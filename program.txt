IMPORT stdlib
IMPORT web

MODULE INDEX WEB
    DATA
        state AS INTEGER
        header AS INTEGER
        label AS INTEGER
        input AS INTEGER
        result AS INTEGER
		oldValue AS STRING OF 255
    END DATA

    DATA INPUT
        ticks AS INTEGER
    END DATA

    DATA OUTPUT
        value AS STRING OF 255
    END DATA

	FUNCTION MAIN
        value = ""

	    IF state = 0 THEN
	        state = 1

            header = createWidget("label")
	        appendWidget(0, header)

	        appendWidget(0, createWidget("break"))

	        label = createWidget("label")
	        appendWidget(0, label)
	        setWidgetData(label, "Enter text here:")

	        appendWidget(0, createWidget("break"))

	        input = createWidget("input")
	        appendWidget(0, input)
            setWidgetData(input, "Example")

            appendWidget(0, createWidget("break"))

	        result = createWidget("label")
	        appendWidget(0, result)

	    ELSE IF state = 1 THEN
	        getWidgetData(input, value)
			IF value <> oldValue THEN
			    IF value = "" THEN
    				setWidgetData(result, "Just enter something! Do it!")
			    ELSE
    				setWidgetData(result, "Entered data: " + value + value)
    			END IF
			END IF
			oldValue = value

            setWidgetData(header, "" + ticks)
	    END IF
	END FUNCTION
END MODULE

MODULE SECOND WEB
    DATA
        state AS INTEGER
        header AS INTEGER
        label AS INTEGER
    END DATA

    DATA INPUT
        ticks AS INTEGER
    END DATA

	FUNCTION MAIN
	    IF state = 0 THEN
	        state = 1

            header = createWidget("label")
	        appendWidget(0, header)
	    ELSE IF state = 1 THEN
            setWidgetData(header, "" + ticks)
	    END IF
	END FUNCTION
END MODULE

MODULE SERVER
    DATA INPUT
        text AS STRING OF 255
    END DATA

    DATA OUTPUT
        ticks AS INTEGER
    END DATA

    FUNCTION MAIN
        IF ticks MOD 100 = 0 THEN
            println("" + ticks / 100 + " " + text)
        END IF
        ticks = ticks + 1
    END FUNCTION
END MODULE

TRANSMISSION
    SERVER.ticks TO INDEX.ticks
    SERVER.ticks TO SECOND.ticks
    INDEX.value TO SERVER.text
END TRANSMISSION
